{% extends "base.html" %}

{% block extra_css %}
<style>
    body {
        background: none !important;
        background-color: white !important;
        background-image: none !important;
    }

    .container {
        background-color: white !important;
    }

    .card {
        background-color: white !important;
    }

    #limit_periodic_inspection, #date_periodic_inspection {
        border-color: #ffa500;
        background-color: #fff3e0 !important;
    }

    #limit_additional_inspection, #date_additional_inspection {
        border-color: #9c27b0;
        background-color: #f3e5f5 !important;
    }

</style>
{% endblock %}

{% block title %}Modifier un Véhicule - Base de données 1{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-body">
            <h1>Modifier un Véhicule</h1>

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('edit_vehicle_1', id=vehicle.id) }}">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="vehicle_type" class="form-label">Type de Véhicule *</label>
                        <input type="text" class="form-control" id="vehicle_type" name="vehicle_type"
                            value="{{ vehicle.vehicle_type }}" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="brand" class="form-label">Marque *</label>
                        <input type="text" class="form-control" id="brand" name="brand" value="{{ vehicle.brand }}"
                            required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="commercial_type" class="form-label">Type Commercial *</label>
                        <input type="text" class="form-control" id="commercial_type" name="commercial_type"
                            value="{{ vehicle.commercial_type }}" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="group_number" class="form-label">Numéro de Groupe</label>
                        <input type="number" class="form-control" id="group_number" name="group_number"
                            value="{{ vehicle.group_number }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="license_plate" class="form-label">Plaque d'Immatriculation *</label>
                        <input type="text" class="form-control" id="license_plate" name="license_plate"
                            value="{{ vehicle.license_plate }}" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="limit_periodic_inspection" class="form-label">Limite CT Périodique</label>
                        <input type="date" class="form-control" id="limit_periodic_inspection" 
                            name="limit_periodic_inspection" placeholder="dd/mm/yyyy"
                            value="{{ vehicle.limit_periodic_inspection.strftime('%Y-%m-%d') if vehicle.limit_periodic_inspection }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="kilometer_periodic_inspection" class="form-label">Kilométrage CT Périodique</label>
                        <input type="number" class="form-control" id="kilometer_periodic_inspection"
                            name="kilometer_periodic_inspection" value="{{ vehicle.kilometer_periodic_inspection }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="limit_additional_inspection" class="form-label">Limite CT Additionnel</label>
                        <input type="date" class="form-control" id="limit_additional_inspection"
                            name="limit_additional_inspection" placeholder="dd/mm/yyyy"
                            value="{{ vehicle.limit_additional_inspection.strftime('%Y-%m-%d') if vehicle.limit_additional_inspection }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="kilometer_additional_inspection" class="form-label">Kilométrage CT Additionnel</label>
                        <input type="number" class="form-control" id="kilometer_additional_inspection"
                            name="kilometer_additional_inspection" value="{{ vehicle.kilometer_additional_inspection }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="date_periodic_inspection" class="form-label">Date CT Périodique</label>
                        <input type="date" class="form-control" id="date_periodic_inspection"
                            name="date_periodic_inspection" placeholder="dd/mm/yyyy"
                            value="{{ vehicle.date_periodic_inspection.strftime('%Y-%m-%d') if vehicle.date_periodic_inspection }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="date_additional_inspection" class="form-label">Date CT Additionnel</label>
                        <input type="date" class="form-control" id="date_additional_inspection"
                            name="date_additional_inspection" placeholder="dd/mm/yyyy"
                            value="{{ vehicle.date_additional_inspection.strftime('%Y-%m-%d') if vehicle.date_additional_inspection }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label for="comments" class="form-label">Commentaires</label>
                    <textarea class="form-control" id="comments" name="comments"
                        rows="3">{{ vehicle.comments }}</textarea>
                </div>

                <div class="mb-3">
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                    <a href="{{ url_for('index_1') }}" class="btn btn-secondary">Annuler</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>

    // Form validation
    (function () {
        'use strict'
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()

    const limitPeriodicInspectionInput = document.getElementById('limit_periodic_inspection');
    const datePeriodicInspectionInput = document.getElementById('date_periodic_inspection');
    let previousDate_perio = limitPeriodicInspectionInput.value;

    limitPeriodicInspectionInput.addEventListener('change', () => {
        const newDate = limitPeriodicInspectionInput.value;
        if (newDate > previousDate_perio) {
            datePeriodicInspectionInput.value = '';
        }
        previousDate_perio = newDate;
    });

    const limitAdditionalInspectionInput = document.getElementById('limit_additional_inspection');
    const dateAdditionalInspectionInput = document.getElementById('date_additional_inspection');
    let previousDate_add = limitAdditionalInspectionInput.value;

    limitAdditionalInspectionInput.addEventListener('change', () => {
        const newDate = limitAdditionalInspectionInput.value;
        if (newDate > previousDate_add) {
            dateAdditionalInspectionInput.value = '';
        }
        previousDate_add = newDate;
    });
</script>

{% endblock %}