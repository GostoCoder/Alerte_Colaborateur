{% extends "base.html" %}

{% block extra_css %}
<style>
    body {
        background: none !important;
        background-color: white !important;
        background-image: none !important;
    }

    .container {
        background-color: white !important;
    }

    .card {
        background-color: white !important;
    }

    .ct-soeco, .ct-date {
        background-color: #e3f2fd !important;
        border-color: #64b5f6;
    }

    .ct-soeco:focus, .ct-date:focus {
        border-color: #2196f3;
        box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
    }

    .chrono-field {
        background-color: #fff3e0 !important;
        border-color: #ffb74d;
    }

    .chrono-field:focus {
        border-color: #ff9800;
        box-shadow: 0 0 0 0.2rem rgba(255, 152, 0, 0.25);
    }

    .limiteur-field {
        background-color: #f3e5f5 !important;
        border-color: #ba68c8;
    }

    .limiteur-field:focus {
        border-color: #9c27b0;
        box-shadow: 0 0 0 0.2rem rgba(156, 39, 176, 0.25);
    }
</style>
{% endblock %}

{% block title %}Modifier un Véhicule - Base de données 2{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-body">
            <h1>Modifier un Véhicule</h1>

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <form method="POST" class="needs-validation" novalidate>
                <div class="row">
                    <!-- Required Fields -->
                    <div class="col-md-4 mb-3">
                        <label for="nom" class="form-label">Nom *</label>
                        <input type="text" class="form-control" id="nom" name="nom"
                            value="{{ collaborateur.nom }}" required>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="prenom" class="form-label">Prénom *</label>
                        <input type="text" class="form-control" id="prenom" name="prenom"
                            value="{{ collaborateur.prenom }}" required>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="date_renouvellement" class="form-label">Date de Renouvellement</label>
                        <input type="date" class="form-control" id="date_renouvellement" name="date_renouvellement"
                            value="{{ collaborateur.date_renouvellement.strftime('%Y-%m-%d') if collaborateur.date_renouvellement }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="date_validite" class="form-label">Date de Validité</label>
                        <input type="date" class="form-control" id="date_validite" name="date_validite"
                            value="{{ collaborateur.date_validite.strftime('%Y-%m-%d') if collaborateur.date_validite }}">
                    </div>

                    <!-- Date Fields -->
                    <div class="col-md-4 mb-3">
                        <label for="ct_soeco_date" class="form-label">Date CT SOECO</label>
                        <input type="date" class="form-control ct-soeco" id="ct_soeco_date" name="ct_soeco_date" 
                            value="{{ vehicle.ct_soeco_date.strftime('%Y-%m-%d') if vehicle.ct_soeco_date }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="euromaster_chrono" class="form-label">Euromaster Chrono</label>
                        <input type="date" class="form-control chrono-field" id="euromaster_chrono" name="euromaster_chrono"
                            value="{{ vehicle.euromaster_chrono.strftime('%Y-%m-%d') if vehicle.euromaster_chrono }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="euromaster_limiteur" class="form-label">Euromaster Limiteur</label>
                        <input type="date" class="form-control limiteur-field" id="euromaster_limiteur" name="euromaster_limiteur"
                            value="{{ vehicle.euromaster_limiteur.strftime('%Y-%m-%d') if vehicle.euromaster_limiteur }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="ned92_chrono" class="form-label">NED 92 Chrono</label>
                        <input type="date" class="form-control chrono-field" id="ned92_chrono" name="ned92_chrono"
                            value="{{ vehicle.ned92_chrono.strftime('%Y-%m-%d') if vehicle.ned92_chrono }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="ned92_limiteur" class="form-label">NED 92 Limiteur</label>
                        <input type="date" class="form-control limiteur-field" id="ned92_limiteur" name="ned92_limiteur"
                            value="{{ vehicle.ned92_limiteur.strftime('%Y-%m-%d') if vehicle.ned92_limiteur }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="date_technical_inspection" class="form-label">Date CT</label>
                        <input type="date" class="form-control ct-date" id="date_technical_inspection" name="date_technical_inspection"
                            value="{{ vehicle.date_technical_inspection.strftime('%Y-%m-%d') if vehicle.date_technical_inspection }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="date_chrono" class="form-label">Date Chrono</label>
                        <input type="date" class="form-control chrono-field" id="date_chrono" name="date_chrono"
                            value="{{ vehicle.date_chrono.strftime('%Y-%m-%d') if vehicle.date_chrono }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="date_limiteur" class="form-label">Date Limiteur</label>
                        <input type="date" class="form-control limiteur-field" id="date_limiteur" name="date_limiteur"
                            value="{{ vehicle.date_limiteur.strftime('%Y-%m-%d') if vehicle.date_limiteur }}">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="kilometer_additional_inspection" class="form-label">Kilométrage Inspection
                            Additionnelle</label>
                        <input type="number" class="form-control" id="kilometer_additional_inspection"
                            name="kilometer_additional_inspection"
                            value="{{ vehicle.kilometer_additional_inspection }}">
                    </div>

                    <div class="col-md-12 mb-3">
                        <label for="commentaire" class="form-label">Commentaire</label>
                        <textarea class="form-control" id="commentaire" name="commentaire"
                            rows="3">{{ collaborateur.commentaire }}</textarea>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col">
                        <button type="submit" class="btn btn-primary">Enregistrer les Modifications</button>
                        <a href="{{ url_for('index_2') }}" class="btn btn-secondary">Annuler</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Form validation
    (function () {
        'use strict'
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()


    const ctSoecoDateInput = document.getElementById('ct_soeco_date');
    const dateTechnicalInspectionInput = document.getElementById('date_technical_inspection');
    let previousDate = ctSoecoDateInput.value;

    ctSoecoDateInput.addEventListener('change', () => {
        const newDate = ctSoecoDateInput.value;
        if (newDate > previousDate) {
            dateTechnicalInspectionInput.value = '';
        }
        previousDate = newDate;
    });

    const euromasterChronoInput = document.getElementById('euromaster_chrono');
    const dateChronoInput = document.getElementById('date_chrono');
    let previousEuromasterDate = euromasterChronoInput.value;

    euromasterChronoInput.addEventListener('change', () => {
        const newDate = euromasterChronoInput.value;
        if (newDate > previousEuromasterDate) {
            dateChronoInput.value = '';
        }
        previousEuromasterDate = newDate;
    });

    const euromasterLimiteurInput = document.getElementById('euromaster_limiteur');
    const dateLimiteurInput = document.getElementById('date_limiteur');
    let previousEuromasterLimiteurDate = euromasterLimiteurInput.value;

    euromasterLimiteurInput.addEventListener('change', () => {
        const newDate = euromasterLimiteurInput.value;
        if (newDate > previousEuromasterLimiteurDate) {
            dateLimiteurInput.value = '';
        }
        previousEuromasterLimiteurDate = newDate;
    });

    const nedChronoInput = document.getElementById('ned92_chrono');
    const dateChronoInput2 = document.getElementById('date_chrono');
    let previousnedDate = nedChronoInput.value;

    nedChronoInput.addEventListener('change', () => {
        const newDate = nedChronoInput.value;
        if (newDate > previousnedDate) {
            dateChronoInput2.value = '';
        }
        previousnedDate = newDate;
    });

    const nedLimiteurInput16 = document.getElementById('ned92_limiteur');
    const dateLimiteurInput2 = document.getElementById('date_limiteur');
    let previousnedLimiteurDate = nedLimiteurInput16.value;

    nedLimiteurInput16.addEventListener('change', () => {
        const newDate = nedLimiteurInput16.value;
        if (newDate > previousnedLimiteurDate) {
            dateLimiteurInput2.value = '';
        }
        previousnedLimiteurDate = newDate;
    });
</script>
{% endblock %}
